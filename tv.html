<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Starship Cinema | Cloud Stream</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    
    <script src="https://accounts.google.com/gsi/client" onload="gisLoaded()"></script>
    <script src="https://apis.google.com/js/api.js" onload="gapiLoaded()"></script>

    <style>
        body { margin: 0; background: #000; color: white; font-family: 'Inter', sans-serif; overflow: hidden; height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        
        #video-viewport { 
            width: 90%; max-width: 1000px; aspect-ratio: 16/9; 
            background: #050505; border-radius: 24px; 
            box-shadow: 0 0 60px rgba(138, 43, 226, 0.3); 
            border: 1px solid rgba(174, 84, 255, 0.2); overflow: hidden; position: relative;
        }
        
        iframe { width: 100%; height: 100%; border: none; }

        .cinema-btn { 
            background: rgba(138, 43, 226, 0.1); border: 1px solid #ae54ff; 
            padding: 14px 30px; border-radius: 50px; cursor: pointer; 
            transition: 0.4s; display: flex; align-items: center; gap: 12px; 
            font-weight: 800; text-transform: uppercase; font-size: 11px;
            letter-spacing: 2px; color: #ae54ff; margin-top: 30px;
        }
        .cinema-btn:hover { background: #8a2be2; color: white; transform: scale(1.05); box-shadow: 0 0 30px #8a2be2; }
        
        .loading-ring { border: 3px solid rgba(255,255,255,0.1); border-top: 3px solid #ae54ff; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; display: none; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div id="video-viewport">
        <div id="placeholder" class="flex flex-col items-center justify-center h-full">
            <i class="material-icons-round text-8xl mb-4 text-purple-900">movie_filter</i>
            <p class="text-gray-500 tracking-widest text-sm">SELECT CLOUD TRANSMISSION</p>
            <div id="loader" class="loading-ring mt-4"></div>
        </div>
        <iframe id="cinema-player" src="" style="display: none;" allow="autoplay; fullscreen"></iframe>
    </div>

    <button class="cinema-btn" onclick="handleAuthClick()">
        <i class="material-icons-round">cloud_queue</i> Browse Starship Drive
    </button>

    <script>
        // CONFIGURATION
        const CLIENT_ID = '106130595767-hlvoakq65984eu1fc9mq0h3951oll8qs.apps.googleusercontent.com';
        const API_KEY = 'AIzaSyDQmlHngYNWqAbveDkUCiuIdgN1ZnnZ2ng';
        const APP_ID = '106130595767'; // Your Project Number

        let tokenClient;
        let accessToken = null;
        let pickerApiLoaded = false;

        function gapiLoaded() { gapi.load('picker', () => { pickerApiLoaded = true; }); }
        
        function gisLoaded() {
            tokenClient = google.accounts.oauth2.initTokenClient({
                client_id: CLIENT_ID,
                scope: 'https://www.googleapis.com/auth/drive.file https://www.googleapis.com/auth/drive.readonly',
                callback: (resp) => { 
                    if (resp.access_token) {
                        accessToken = resp.access_token; 
                        createPicker(); 
                    }
                },
            });
        }

        function handleAuthClick() {
            if (accessToken === null) {
                tokenClient.requestAccessToken({prompt: 'consent'});
            } else {
                createPicker();
            }
        }

        function createPicker() {
            if (!pickerApiLoaded) return;
            
            const view = new google.picker.View(google.picker.ViewId.DOCS);
            view.setMimeTypes("video/mp4,video/webm,video/quicktime,video/x-matroska");

            const picker = new google.picker.PickerBuilder()
                .enableFeature(google.picker.Feature.NAV_HIDDEN)
                .setAppId(APP_ID)
                .setOAuthToken(accessToken)
                .setDeveloperKey(API_KEY)
                .addView(view)
                .setOrigin(window.location.origin)
                .setCallback(pickerCallback)
                .build();
            picker.setVisible(true);
        }

        function pickerCallback(data) {
            if (data.action == google.picker.Action.PICKED) {
                const doc = data.docs[0];
                const fileId = doc.id;
                
                // Show loader
                document.getElementById('loader').style.display = 'block';
                
                // Switch to Player
                const player = document.getElementById('cinema-player');
                player.src = `https://drive.google.com/file/d/${fileId}/preview`;
                
                setTimeout(() => {
                    document.getElementById('placeholder').style.display = 'none';
                    player.style.display = 'block';
                    if(window.parent.Kernel) window.parent.Kernel.notify("NOW PLAYING: " + doc.name);
                }, 1000);
            }
        }
    </script>
</body>
</html>
