<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dev Resource Portal</title>
    <script src="https://js.puter.com/v2/"></script>
    <style>
        body { background: #0f172a; color: #f8fafc; font-family: sans-serif; margin: 0; overflow-x: hidden; }
        #auth-gate { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; }
        .box { background: #1e293b; padding: 2rem; border-radius: 12px; text-align: center; width: 350px; box-shadow: 0 10px 15px rgba(0,0,0,0.3); }
        input { width: 100%; padding: 12px; margin: 10px 0; border-radius: 6px; border: 1px solid #334155; background: #0f172a; color: white; box-sizing: border-box; }
        button { width: 100%; padding: 12px; background: #38bdf8; color: #0f172a; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; }
        #viewer { width: 100%; height: 100vh; background: white; color: black; display: none; overflow: auto; }
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div id="auth-gate">
        <div class="box">
            <h2>System Login</h2>
            <input type="password" id="pass" placeholder="Enter Access Code">
            <button onclick="login()">Unlock</button>
        </div>
    </div>

    <div id="proxy-ui" class="hidden" style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh;">
        <div class="box">
            <h2>Secure Tunnel</h2>
            <input type="text" id="target-url" placeholder="https://example.com">
            <button onclick="launch()">Launch Proxy</button>
        </div>
    </div>

    <div id="viewer"></div>

    <script>
        const passHash = "VGl0YW43Nw=="; // Password: Titan77

        function login() {
            const val = document.getElementById('pass').value;
            if (btoa(val) === passHash) {
                document.getElementById('auth-gate').classList.add('hidden');
                document.getElementById('proxy-ui').classList.remove('hidden');
            } else { alert("Wrong Code"); }
        }

        async function launch() {
            const url = document.getElementById('target-url').value;
            if (!url) return;

            document.getElementById('proxy-ui').classList.add('hidden');
            const viewer = document.getElementById('viewer');
            viewer.style.display = 'block';
            viewer.innerHTML = "Opening Tunnel...";

            try {
                // Fetch the site through Puter's network (Bypasses CORS/Filters)
                const resp = await puter.net.fetch(url);
                let html = await resp.text();

                // Simple Rewrite: Fix relative links and images
                const base = `<base href="${url}">`;
                html = html.replace('<head>', `<head>${base}`);

                // Inject the site directly into our DIV (No Iframe!)
                viewer.innerHTML = html;

                // Attempt to re-trigger scripts manually if needed
                const scripts = viewer.querySelectorAll("script");
                scripts.forEach(oldScript => {
                    const newScript = document.createElement("script");
                    Array.from(oldScript.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value));
                    newScript.appendChild(document.createTextNode(oldScript.innerHTML));
                    oldScript.parentNode.replaceChild(newScript, oldScript);
                });

            } catch (err) {
                viewer.innerHTML = "Tunnel Failed: " + err.message;
            }
        }
    </script>
</body>
</html>
