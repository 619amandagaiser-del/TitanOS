<!DOCTYPE html>
<html>
<head>
    <script src="https://accounts.google.com/gsi/client" onload="gisLoaded()"></script>
    <script src="https://apis.google.com/js/api.js" onload="gapiLoaded()"></script>
    <style>
        body { background: #0d0d14; color: white; font-family: sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; margin: 0; }
        .drive-btn { background: #4285F4; color: white; border: none; padding: 15px 30px; border-radius: 5px; font-weight: bold; cursor: pointer; display: flex; align-items: center; gap: 10px; }
        .status { margin-top: 20px; font-size: 12px; color: #8a2be2; }
    </style>
</head>
<body>
    <button class="drive-btn" onclick="handleAuthClick()">
        <img src="https://upload.wikimedia.org/wikipedia/commons/1/12/Google_Drive_icon_%282020%29.svg" width="20">
        Connect Starship to Drive
    </button>
    <div id="status" class="status">Waiting for authentication...</div>

    <script>
        let tokenClient;
        let accessToken = null;

        function gapiLoaded() { gapi.load('client:picker', () => {}); }
        function gisLoaded() {
            tokenClient = google.accounts.oauth2.initTokenClient({
                client_id: parent.DRIVE_CONFIG.clientId,
                scope: parent.DRIVE_CONFIG.scopes,
                callback: (resp) => { accessToken = resp.access_token; createPicker(); },
            });
        }

        function handleAuthClick() {
            if (accessToken === null) {
                tokenClient.requestAccessToken({prompt: 'consent'});
            } else {
                createPicker();
            }
        }

        function createPicker() {
            const view = new google.picker.View(google.picker.ViewId.DOCS);
            const picker = new google.picker.PickerBuilder()
                .enableFeature(google.picker.Feature.NAV_HIDDEN)
                .setDeveloperKey(parent.DRIVE_CONFIG.apiKey)
                .setAppId(parent.DRIVE_CONFIG.clientId)
                .setOAuthToken(accessToken)
                .addView(view)
                .setCallback(pickerCallback)
                .build();
            picker.setVisible(true);
        }

        function pickerCallback(data) {
            if (data.action == google.picker.Action.PICKED) {
                const doc = data.docs[0];
                document.getElementById('status').innerText = "Selected: " + doc.name;
                // You can now send this file URL back to your Star TV or Orbit AI
                console.log("File ID: " + doc.id);
            }
        }
    </script>
</body>
</html>
