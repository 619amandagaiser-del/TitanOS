<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TitanOS</title>
    
    <script src="https://accounts.google.com/gsi/client" onload="gisLoaded()"></script>
    <script src="https://apis.google.com/js/api.js" onload="gapiLoaded()"></script>

    <style>
        :root { --primary: #8a2be2; --bg: #0d0d14; --win-bg: rgba(20, 20, 30, 0.95); }
        body, html { margin: 0; padding: 0; height: 100%; overflow: hidden; font-family: 'Segoe UI', sans-serif; background: var(--bg); color: white; }
        
        /* Desktop & Icons */
        #desktop { width: 100vw; height: 100vh; position: relative; background-size: cover; background-position: center; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, 100px); gap: 20px; padding: 20px; }
        .icon { display: flex; flex-direction: column; align-items: center; cursor: pointer; transition: 0.2s; }
        .icon:hover { transform: scale(1.1); }
        .icon-img { width: 50px; height: 50px; background: rgba(255,255,255,0.1); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px; margin-bottom: 5px; }

        /* Window System */
        .window { position: absolute; background: var(--win-bg); border: 1px solid rgba(138, 43, 226, 0.3); border-radius: 12px; display: none; flex-direction: column; box-shadow: 0 10px 30px rgba(0,0,0,0.5); backdrop-filter: blur(15px); min-width: 300px; min-height: 200px; overflow: hidden; }
        .win-header { padding: 10px 15px; background: rgba(255,255,255,0.05); display: flex; justify-content: space-between; align-items: center; cursor: move; }
        .win-content { flex: 1; overflow-y: auto; padding: 15px; }
        .close-btn { background: #ff5f56; border: none; width: 12px; height: 12px; border-radius: 50%; cursor: pointer; }

        /* App Specific Styles */
        .show-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 15px; }
        iframe { width: 100%; height: 100%; border: none; }
        
        /* Cinema Mode */
        body.cinema-mode .icon, body.cinema-mode #taskbar { display: none; }
        body.cinema-mode .window.active-video { top: 0 !important; left: 0 !important; width: 100vw !important; height: 100vh !important; border: none; z-index: 9999; }
    </style>
</head>
<body>

<div id="desktop">
    <div class="grid">
        <div class="icon" onclick="openWin('win-drive')"><div class="icon-img">‚òÅÔ∏è</div><span>Drive</span></div>
        <div class="icon" onclick="openWin('win-shows')"><div class="icon-img">üé¨</div><span>Shows</span></div>
        <div class="icon" onclick="openWin('win-yt')"><div class="icon-img">üì∫</div><span>YouTube</span></div>
    </div>

    <div id="win-drive" class="window" style="width: 350px; top: 100px; left: 100px;">
        <div class="win-header"><span>Titan Drive</span><button class="close-btn" onclick="closeWin('win-drive')"></button></div>
        <div class="win-content" style="text-align:center;">
            <p>Access your cloud media</p>
            <button onclick="handleAuthClick()" style="padding:10px 20px; background:#4285F4; color:white; border:none; border-radius:5px; cursor:pointer;">Connect Drive</button>
        </div>
    </div>

    <div id="win-shows" class="window" style="width: 600px; height: 400px; top: 150px; left: 200px;">
        <div class="win-header"><span>My Library</span><button class="close-btn" onclick="closeWin('win-shows')"></button></div>
        <div class="win-content"><div id="shows-grid" class="show-grid"></div></div>
    </div>

    <div id="win-player" class="window" style="width: 800px; height: 500px; top: 50px; left: 50px;">
        <div class="win-header"><span>Titan Player</span><button class="close-btn" onclick="exitCinema()"></button></div>
        <div class="win-content" style="padding:0; background:#000;">
            <iframe id="main-player" src=""></iframe>
        </div>
    </div>
</div>

<script>
    // --- CONFIGURATION ---
    const TITAN_CONFIG = {
        drive: {
            clientId: 'YOUR_CLIENT_ID',
            apiKey: 'AIzaSyBJDwenuskInIOJ-bUtACFAiITJ0jHwWG0',
            scopes: 'https://www.googleapis.com/auth/drive.readonly'
        }
    };

    let accessToken = null;
    let tokenClient;

    // --- WINDOW LOGIC ---
    function openWin(id) { document.getElementById(id).style.display = 'flex'; }
    function closeWin(id) { document.getElementById(id).style.display = 'none'; }

    // --- GOOGLE DRIVE INTEGRATION ---
    function gapiLoaded() { gapi.load('client:picker', () => {}); }
    function gisLoaded() {
        tokenClient = google.accounts.oauth2.initTokenClient({
            client_id: TITAN_CONFIG.drive.clientId,
            scope: TITAN_CONFIG.drive.scopes,
            callback: (resp) => { accessToken = resp.access_token; createPicker(); },
        });
    }

    function handleAuthClick() {
        if (!accessToken) tokenClient.requestAccessToken({prompt: 'consent'});
        else createPicker();
    }

    function createPicker() {
        const view = new google.picker.View(google.picker.ViewId.DOCS);
        view.setMimeTypes("video/mp4,video/webm");
        const picker = new google.picker.PickerBuilder()
            .setDeveloperKey(TITAN_CONFIG.drive.apiKey).setAppId(TITAN_CONFIG.drive.clientId)
            .setOAuthToken(accessToken).addView(view).setCallback(pickerCallback).build();
        picker.setVisible(true);
    }

    function pickerCallback(data) {
        if (data.action == google.picker.Action.PICKED) {
            const file = data.docs[0];
            loadVideo(file.id);
            saveToLibrary(file.id, file.name);
        }
    }

    // --- VIDEO PLAYER & CINEMA MODE ---
    function loadVideo(fileId) {
        const player = document.getElementById('main-player');
        player.src = `https://drive.google.com/file/d/${fileId}/preview`;
        openWin('win-player');
        document.body.classList.add('cinema-mode');
        document.getElementById('win-player').classList.add('active-video');
    }

    function exitCinema() {
        document.body.classList.remove('cinema-mode');
        document.getElementById('win-player').classList.remove('active-video');
        document.getElementById('main-player').src = "";
        closeWin('win-player');
    }

    // --- LIBRARY LOGIC ---
    let library = JSON.parse(localStorage.getItem('titan-lib')) || [];

    function saveToLibrary(id, name) {
        if (!library.find(i => i.id === id)) {
            library.push({id, name});
            localStorage.setItem('titan-lib', JSON.stringify(library));
            renderLibrary();
        }
    }

    function renderLibrary() {
        const grid = document.getElementById('shows-grid');
        grid.innerHTML = library.map(item => `
            <div onclick="loadVideo('${item.id}')" style="background:#222; padding:10px; border-radius:8px; cursor:pointer; text-align:center;">
                <div style="font-size:30px;">üé¨</div>
                <div style="font-size:12px; margin-top:5px;">${item.name}</div>
            </div>
        `).join('');
    }

    window.onload = renderLibrary;
</script>

</body>
</html>
