<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Titan OS | iPad Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    <script src="https://accounts.google.com/gsi/client"></script>
    <script src="https://apis.google.com/js/api.js"></script>
    
    <style>
        :root { --cyan: #00f2ff; }
        body, html { 
            margin: 0; padding: 0; height: 100vh; width: 100vw; 
            overflow: hidden; background: #000; color: #fff;
            -webkit-user-select: none; user-select: none;
        }
        #desktop { 
            position: absolute; inset: 0; 
            background: radial-gradient(circle at center, #002222 0%, #000 100%);
            z-index: 10;
        }
        
        /* Over-sized iPad Dock */
        #dock { 
            position: fixed; bottom: 40px; left: 50%; transform: translateX(-50%); 
            background: rgba(255,255,255,0.1); border: 1px solid rgba(0,242,255,0.4); 
            backdrop-filter: blur(20px); border-radius: 30px; 
            padding: 15px 40px; display: flex; gap: 40px; z-index: 999999; 
        }
        .dock-item { color: var(--cyan); font-size: 50px; cursor: pointer; transition: 0.1s; }
        .dock-item:active { transform: scale(0.8); opacity: 0.5; }

        /* iPad Native Windows (No Iframes) */
        .window { 
            position: absolute; top: 10%; left: 5%; width: 90%; height: 75%; 
            background: rgba(15, 15, 20, 0.95); border: 1px solid var(--cyan); 
            border-radius: 20px; z-index: 10000; display: flex; flex-direction: column; 
            box-shadow: 0 0 50px rgba(0,0,0,1);
        }
        .win-bar { 
            padding: 15px 20px; background: rgba(255,255,255,0.05); 
            display: flex; justify-content: space-between; align-items: center;
        }
        .win-body { flex-grow: 1; padding: 20px; overflow-y: auto; -webkit-overflow-scrolling: touch; }
        
        input, button { -webkit-appearance: none; border-radius: 10px; }
    </style>
</head>
<body>

    <div id="desktop">
        <div id="dock">
            <i class="material-icons-round dock-item" id="btn-exp">folder</i>
            <i class="material-icons-round dock-item" id="btn-cin">movie</i>
        </div>
    </div>

    <div id="win-layer"></div>

    <script>
        const Titan = {
            token: null,
            playlist: [],

            init() {
                // Hard-binding touch events for iPad
                document.getElementById('btn-exp').addEventListener('touchstart', (e) => { e.preventDefault(); this.open('explorer'); });
                document.getElementById('btn-cin').addEventListener('touchstart', (e) => { e.preventDefault(); this.open('cinema'); });
            },

            open(type) {
                if(document.getElementById('win-'+type)) return;
                const win = document.createElement('div');
                win.id = 'win-'+type;
                win.className = 'window';
                
                win.innerHTML = `
                    <div class="win-bar">
                        <b style="color:var(--cyan); letter-spacing:2px">${type.toUpperCase()}</b>
                        <span onclick="this.closest('.window').remove()" style="color:#ff4444; font-weight:bold; padding:10px">CLOSE</span>
                    </div>
                    <div class="win-body" id="body-${type}"></div>
                `;
                document.getElementById('win-layer').appendChild(win);
                this.render(type);
            },

            render(type) {
                const container = document.getElementById('body-'+type);
                if(type === 'explorer') {
                    container.innerHTML = `
                        <button onclick="Titan.connect()" class="w-full bg-cyan-500 text-black py-5 rounded-xl font-bold mb-10 text-lg">1. CONNECT GOOGLE DRIVE</button>
                        <input id="show-input" placeholder="Series Name..." class="w-full bg-zinc-900 border border-zinc-700 p-5 mb-5 text-white text-lg">
                        <button onclick="Titan.pick()" class="w-full border-2 border-cyan-500 text-cyan-500 py-5 rounded-xl font-bold text-lg">2. SELECT FOLDER</button>
                    `;
                } else {
                    this.syncCinema();
                }
            },

            connect() {
                const client = google.accounts.oauth2.initTokenClient({
                    client_id: '106130595767-hlvoakq65984eu1fc9mq0h3951oll8qs.apps.googleusercontent.com',
                    scope: 'https://www.googleapis.com/auth/drive.readonly',
                    callback: (r) => { this.token = r.access_token; alert("SUCCESS: Connected to Drive"); }
                });
                client.requestAccessToken();
            },

            pick() {
                if(!this.token) return alert("Connect Drive First!");
                gapi.load('picker', () => {
                    const view = new google.picker.DocsView(google.picker.ViewId.FOLDERS);
                    const picker = new google.picker.PickerBuilder()
                        .setAppId('106130595767').setOAuthToken(this.token).setDeveloperKey('AIzaSyDQmlHngYNWqAbveDkUCiuIdgN1ZnnZ2ng')
                        .addView(view).setCallback(async (d) => {
                            if (d.action == "picked") {
                                const res = await fetch(`https://www.googleapis.com/drive/v3/files?q='${d.docs[0].id}'+in+parents&fields=files(id,name,mimeType)&key=AIzaSyDQmlHngYNWqAbveDkUCiuIdgN1ZnnZ2ng`, {
                                    headers: { 'Authorization': 'Bearer ' + this.token }
                                });
                                const j = await res.json();
                                this.playlist = j.files.filter(f => f.mimeType.includes('video')).sort((a,b) => a.name.localeCompare(b.name, undefined, {numeric: true}));
                                alert("Mounted " + this.playlist.length + " Episodes");
                            }
                        }).build();
                    picker.setVisible(true);
                });
            },

            syncCinema() {
                const container = document.getElementById('body-cinema');
                if(!container) return;
                container.innerHTML = `
                    <div id="player-box" class="w-full aspect-video bg-black rounded-lg mb-5 flex items-center justify-center border border-zinc-800">
                        <iframe id="main-v" class="w-full h-full hidden" allow="autoplay; fullscreen"></iframe>
                        <div id="placeholder">SELECT AN EPISODE</div>
                    </div>
                    <div class="grid grid-cols-2 gap-4" id="ep-list"></div>
                `;
                const list = container.querySelector('#ep-list');
                this.playlist.forEach((ep, i) => {
                    const item = document.createElement('div');
                    item.className = "bg-zinc-900 p-4 rounded-lg border border-zinc-800 active:bg-cyan-900";
                    item.innerHTML = `<b class="text-cyan-500">EP ${i+1}</b><div class="truncate text-xs text-zinc-400">${ep.name}</div>`;
                    item.onclick = () => {
                        document.getElementById('placeholder').style.display = 'none';
                        const v = document.getElementById('main-v');
                        v.src = `https://drive.google.com/file/d/${ep.id}/preview`;
                        v.style.display = 'block';
                    };
                    list.appendChild(item);
                });
            }
        };

        window.onload = () => Titan.init();
    </script>
</body>
</html>
