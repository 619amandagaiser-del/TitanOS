<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Zenith OS</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    <style>
        :root { --bg: #000; --accent: #4285F4; --term: #00FF41; --red: #E50914; --win: #0f0f0f; }
        body { margin: 0; background: var(--bg); font-family: sans-serif; color: white; overflow: hidden; height: 100vh; }
        
        /* DESKTOP LAYOUT */
        #desktop { padding: 50px; display: flex; flex-wrap: wrap; gap: 40px; align-content: flex-start; height: calc(100vh - 50px); z-index: 1; }
        .icon { width: 90px; display: flex; flex-direction: column; align-items: center; cursor: pointer; text-align: center; }
        .icon i { font-size: 50px; color: #444; margin-bottom: 10px; }
        .icon span { font-size: 10px; font-weight: bold; text-transform: uppercase; letter-spacing: 1px; }

        /* WINDOWS */
        .window { position: absolute; background: var(--win); border-radius: 12px; border: 1px solid #222; display: none; flex-direction: column; overflow: hidden; z-index: 10; min-width: 300px; }
        .win-bar { height: 40px; background: #000; display: flex; align-items: center; padding: 0 15px; cursor: move; }
        .win-title { flex-grow: 1; font-size: 10px; font-weight: 900; color: #555; }
        .win-content { flex-grow: 1; display: flex; flex-direction: column; background: #000; }

        /* UI ELEMENTS */
        .nav-bar { height: 45px; background: #111; display: flex; align-items: center; padding: 0 10px; gap: 10px; border-bottom: 1px solid #222; }
        .nav-input { flex-grow: 1; background: #000; border: 1px solid #333; color: white; padding: 6px 15px; border-radius: 20px; font-size: 12px; }
        #panic { position: fixed; inset: 0; background: white; z-index: 99999; display: none; }
        iframe { border: none; width: 100%; height: 100%; }
        
        /* ADMIN PANEL SPECIFICS */
        .admin-box { padding: 20px; color: var(--term); font-family: monospace; }
        .admin-btn { background: var(--term); color: black; border: none; padding: 10px; width: 100%; margin-top: 10px; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body onload="OS.init()">

    <div id="panic"><iframe src="https://classroom.google.com"></iframe></div>

    <div id="desktop">
        <div class="icon" onclick="OS.open('web-win')">
            <i class="material-icons-round" style="color:#34a853;">language</i>
            <span>WEB NODE</span>
        </div>
        </div>

    <div id="web-win" class="window" style="width: 80%; height: 70%; top: 10%; left: 10%;">
        <div class="win-bar" onmousedown="OS.drag(event, 'web-win')">
            <div class="win-title">TITAN_BROWSER</div>
            <i class="material-icons-round" style="cursor:pointer;" onclick="OS.close('web-win')">close</i>
        </div>
        <div class="nav-bar">
            <input type="text" id="web-url" class="nav-input" placeholder="Enter URL..." onkeypress="if(event.key==='Enter') OS.navigate()">
        </div>
        <div class="win-content">
            <iframe id="web-frame" src="about:blank"></iframe>
        </div>
    </div>

    <div id="admin-win" class="window" style="width: 400px; height: 500px; top: 15%; left: 30%;">
        <div class="win-bar" onmousedown="OS.drag(event, 'admin-win')">
            <div class="win-title">ROOT_CONSOLE</div>
            <i class="material-icons-round" style="cursor:pointer;" onclick="OS.close('admin-win')">close</i>
        </div>
        <div class="admin-box">
            <label>SHOW NAME:</label><br>
            <input type="text" id="s-name" style="width:90%;"><br><br>
            <label>DRIVE FOLDER ID:</label><br>
            <input type="text" id="s-id" style="width:90%;"><br>
            <button class="admin-btn" onclick="OS.saveShow()">INJECT SHOW</button>
            <hr style="border-color:#222; margin:20px 0;">
            <button class="admin-btn" style="background:red; color:white;" onclick="OS.startCall()">INIT VOICE BRIDGE</button>
        </div>
    </div>

    <script type="module">
        // Import Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set, push, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDQmlHngYNWqAbveDkUCiuIdgN1ZnnZ2ng",
            databaseURL: "https://titan-84c56-default-rtdb.firebaseio.com"
        };
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const showsRef = ref(db, 'shows');

        let secretBuffer = "";

        window.OS = {
            init() {
                console.log("OS_KERNEL: Booting...");
                
                // 1. GHOST LISTENER
                document.addEventListener('keydown', e => {
                    if(e.key === '`') document.getElementById('panic').style.display = 'block';
                    
                    secretBuffer += e.key;
                    if (secretBuffer.endsWith("Ck04242014")) { this.open('admin-win'); secretBuffer = ""; }
                    if (secretBuffer.length > 20) secretBuffer = "";
                });

                // 2. FIREBASE SYNC (This pulls your shows)
                onValue(showsRef, (snap) => {
                    const data = snap.val();
                    // Remove old dynamic icons
                    document.querySelectorAll('.dynamic-show').forEach(e => e.remove());
                    
                    if (data) {
                        Object.entries(data).forEach(([key, s]) => {
                            const d = document.createElement('div');
                            d.className = "icon dynamic-show";
                            d.onclick = () => {
                                document.getElementById('web-frame').src = `https://drive.google.com/embeddedfolderview?id=${s.folderId}#grid`;
                                this.open('web-win');
                            };
                            d.innerHTML = `<i class="material-icons-round" style="color:var(--red)">play_circle_filled</i><span>${s.name}</span>`;
                            document.getElementById('desktop').appendChild(d);
                        });
                    }
                });
            },

            navigate() {
                let url = document.getElementById('web-url').value;
                if(!url.startsWith('http')) url = 'https://' + url;
                document.getElementById('web-frame').src = url;
            },

            saveShow() {
                const n = document.getElementById('s-name').value;
                const i = document.getElementById('s-id').value;
                if(n && i) {
                    push(showsRef, { name: n, folderId: i });
                    alert("INJECTED TO CLOUD");
                }
            },

            open(id) { document.getElementById(id).style.display = 'flex'; },
            close(id) { document.getElementById(id).style.display = 'none'; },
            
            drag(e, id) {
                const w = document.getElementById(id);
                let ox = e.clientX - w.offsetLeft, oy = e.clientY - w.offsetTop;
                const m = ev => { w.style.left = ev.clientX - ox + 'px'; w.style.top = ev.clientY - oy + 'px'; };
                document.addEventListener('mousemove', m);
                document.onmouseup = () => document.removeEventListener('mousemove', m);
            }
        };
    </script>
</body>
</html>
