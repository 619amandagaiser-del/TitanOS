<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ShadowOS | Ultimate</title>
    <script src="https://js.puter.com/v2/" defer></script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: url('https://images.unsplash.com/photo-1451187580459-43490279c0fa?q=80&w=2072');
            --accent: #3b82f6; --win-bg: #0f172a; --text: #e2e8f0; --discord: #313338;
        }
        * { box-sizing: border-box; user-select: none; }
        body { margin: 0; overflow: hidden; height: 100vh; font-family: 'Inter', sans-serif; color: var(--text); background: #000; }
        #wallpaper { position: absolute; inset: 0; background: var(--bg) no-repeat center center/cover; z-index: -1; filter: brightness(0.4); }

        /* Desktop & Icons */
        #desktop { height: calc(100vh - 48px); display: flex; flex-direction: column; flex-wrap: wrap; align-content: flex-start; padding: 20px; gap: 20px; }
        .icon { width: 85px; display: flex; flex-direction: column; align-items: center; cursor: pointer; text-shadow: 0 2px 5px black; }
        .icon i { font-size: 40px; margin-bottom: 5px; color: var(--accent); }
        .icon span { font-size: 10px; font-weight: 900; text-align: center; letter-spacing: 1px; }

        /* Windows */
        .window { position: absolute; background: var(--win-bg); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; box-shadow: 0 25px 50px rgba(0,0,0,0.8); display: flex; flex-direction: column; overflow: hidden; }
        .win-bar { height: 40px; background: rgba(30, 41, 59, 0.95); display: flex; align-items: center; padding: 0 15px; cursor: move; }
        .win-title { font-size: 10px; font-weight: 900; flex-grow: 1; letter-spacing: 2px; }
        .win-controls { display: flex; gap: 8px; }
        .win-btn { width: 12px; height: 12px; border-radius: 50%; border: none; cursor: pointer; }

        /* Discord UI Styling */
        .discord-container { display: flex; height: 100%; background: var(--discord); }
        .discord-sidebar { width: 60px; background: #1e1f22; display: flex; flex-direction: column; align-items: center; padding: 15px 0; gap: 10px; }
        .discord-btn { width: 40px; height: 40px; background: #35363c; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; color: #dbdee1; transition: 0.2s; }
        .discord-btn:hover { border-radius: 12px; background: #5865f2; color: white; }
        .discord-main { flex-grow: 1; display: flex; flex-direction: column; }
        .msg-area { flex-grow: 1; padding: 20px; overflow-y: auto; color: #dcddde; font-size: 14px; }
        .call-overlay { position: absolute; inset: 0; background: #000; z-index: 100; display: none; }

        /* Taskbar */
        #taskbar { position: absolute; bottom: 0; width: 100%; height: 48px; background: rgba(15, 23, 42, 0.95); backdrop-filter: blur(15px); border-top: 1px solid rgba(255,255,255,0.1); display: flex; align-items: center; padding: 0 20px; z-index: 10000; }
        .tray { display: flex; align-items: center; gap: 15px; margin-left: auto; font-family: 'JetBrains Mono'; font-size: 12px; color: #94a3b8; }
        
        iframe { width: 100%; height: 100%; border: none; background: white; }
        .url-box { flex-grow: 1; background: #0f172a; border: 1px solid #334155; color: #64748b; padding: 6px 15px; border-radius: 20px; font-family: 'JetBrains Mono'; font-size: 11px; outline: none; }
    </style>
</head>
<body onload="OS.init()">

    <div id="wallpaper"></div>
    <div id="desktop"></div>

    <div id="taskbar">
        <div style="font-weight: 900; letter-spacing: 2px;">SHADOW<span style="color:var(--accent)">V8</span></div>
        <div class="tray">
            <div style="display:flex; align-items:center; gap:5px;"><i class="material-icons-round" id="bat-icon" style="font-size:16px;">battery_full</i><span id="bat-level">--%</span></div>
            <div id="clock">00:00</div>
        </div>
    </div>

    <script>
        const OS = {
            zIndex: 100,
            init() {
                this.renderDesktop();
                this.initBattery();
                this.loadStyles();
                setInterval(() => {
                    document.getElementById('clock').innerText = new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
                }, 1000);
                document.addEventListener('keydown', e => { if(e.key === "Escape") location.href='https://google.com'; });
            },

            loadStyles() {
                const acc = localStorage.getItem('sh_accent');
                if(acc) document.documentElement.style.setProperty('--accent', acc);
            },

            cloak() {
                const win = window.open('about:blank', '_blank');
                const doc = win.document;
                const iframe = doc.createElement('iframe');
                doc.title = "about:blank";
                iframe.style = "position:fixed; top:0; left:0; width:100%; height:100%; border:none;";
                iframe.src = window.location.href;
                doc.body.appendChild(iframe);
                window.location.replace('https://google.com');
            },

            renderDesktop() {
                const apps = [
                    { id: 'cloak', name: 'Cloak', icon: 'visibility_off' },
                    { id: 'browser', name: 'Browser', icon: 'public' },
                    { id: 'chat', name: 'ShadowLink', icon: 'forum' },
                    { id: 'notepad', name: 'Notepad', icon: 'edit' },
                    { id: 'games', name: 'Arcade', icon: 'sports_esports' },
                    { id: 'settings', name: 'Settings', icon: 'settings' }
                ];
                const d = document.getElementById('desktop');
                apps.forEach(app => {
                    const div = document.createElement('div');
                    div.className = 'icon';
                    div.innerHTML = `<i class="material-icons-round">${app.icon}</i><span>${app.name.toUpperCase()}</span>`;
                    div.onclick = () => app.id === 'cloak' ? this.cloak() : this.openWindow(app);
                    d.appendChild(div);
                });
            },

            openWindow(app) {
                const id = 'win_' + Date.now();
                const win = document.createElement('div');
                win.className = 'window'; win.id = id;
                win.style.width = '900px'; win.style.height = '600px';
                win.style.left = '50px'; win.style.top = '50px';
                win.style.zIndex = ++this.zIndex;

                let content = '';
                if(app.id === 'browser') {
                    content = `<div style="display:flex; flex-direction:column; height:100%;"><div style="padding:10px; background:#1e293b; display:flex;"><input type="text" id="url_${id}" class="url-box" placeholder="Search or URL..." onkeypress="if(event.key==='Enter') OS.navigate('${id}')"></div><iframe id="frame_${id}" src="about:blank"></iframe></div>`;
                } else if(app.id === 'chat') {
                    content = `
                        <div class="discord-container">
                            <div class="discord-sidebar"><div class="discord-btn" onclick="OS.startCall('${id}')"><i class="material-icons-round">call</i></div></div>
                            <div class="discord-main">
                                <div style="padding:15px; border-bottom:1px solid #26272d; font-weight:900; font-size:12px;"># ENCRYPTED-CHANNEL</div>
                                <div class="msg-area" id="msgs_${id}">[SYS] Secure. Hit phone for P2P video/voice.</div>
                                <div style="padding:15px;"><input type="text" style="width:100%; background:#383a40; border:none; padding:10px; border-radius:5px; color:white; outline:none;" placeholder="Message..." onkeypress="if(event.key==='Enter') OS.sendChat('${id}', this)"></div>
                            </div>
                            <div id="call_${id}" class="call-overlay"></div>
                        </div>`;
                } else if(app.id === 'notepad') {
                    content = `<textarea id="note_${id}" style="width:100%; height:100%; background:#0f172a; color:white; border:none; padding:20px; outline:none; font-family:'JetBrains Mono'; resize:none;" oninput="localStorage.setItem('sh_note', this.value)">${localStorage.getItem('sh_note')||''}</textarea>`;
                } else if(app.id === 'settings') {
                    content = `<div style="padding:30px;"><label>ACCENT COLOR</label><br><input type="color" onchange="OS.setAccent(this.value)" style="margin-top:10px; cursor:pointer;"></div>`;
                } else {
                    content = `<iframe src="https://ubg365.github.io/"></iframe>`;
                }

                win.innerHTML = `<div class="win-bar" onmousedown="OS.dragStart(event, '${id}')"><div class="win-title">${app.name.toUpperCase()}</div><div class="win-controls"><button class="win-btn" style="background:#22c55e" onclick="OS.maximize('${id}')"></button><button class="win-btn" style="background:#ef4444" onclick="document.getElementById('${id}').remove()"></button></div></div><div style="flex-grow:1; position:relative; overflow:hidden;">${content}</div>`;
                document.body.appendChild(win);
            },

            navigate(winId) {
                const input = document.getElementById(`url_${winId}`);
                const frame = document.getElementById(`frame_${winId}`);
                let url = input.value;
                if(!url.includes('.') || url.includes(' ')) url = `https://www.google.com/search?q=${encodeURIComponent(url)}&igu=1`;
                else if(!url.startsWith('http')) url = 'https://' + url;
                input.value = "sys_secure_" + btoa(url).substring(0, 10) + ".tmp";
                frame.src = `https://api.codetabs.com/v1/proxy?quest=${url}`;
            },

            startCall(id) {
                const overlay = document.getElementById(`call_${id}`);
                overlay.style.display = 'block';
                overlay.innerHTML = `<iframe src="https://meet.jit.si/ShadowCall_${Math.random().toString(36).substring(7)}" allow="camera; microphone; fullscreen; autoplay" style="width:100%; height:100%;"></iframe><button onclick="this.parentElement.style.display='none'; this.parentElement.innerHTML=''" style="position:absolute; bottom:20px; left:50%; transform:translateX(-50%); background:#ef4444; border:none; color:white; padding:10px 20px; border-radius:5px; cursor:pointer;">END CALL</button>`;
            },

            sendChat(id, input) {
                const box = document.getElementById(`msgs_${id}`);
                box.innerHTML += `<div><span style="color:var(--accent); font-weight:bold;">Admin:</span> ${input.value}</div>`;
                input.value = ''; box.scrollTop = box.scrollHeight;
            },

            setAccent(val) { localStorage.setItem('sh_accent', val); document.documentElement.style.setProperty('--accent', val); },

            initBattery() {
                if (navigator.getBattery) navigator.getBattery().then(bat => {
                    const up = () => {
                        document.getElementById('bat-level').innerText = Math.round(bat.level * 100) + '%';
                        document.getElementById('bat-icon').innerText = bat.charging ? 'battery_charging_full' : 'battery_full';
                    };
                    up(); bat.onlevelchange = up; bat.onchargingchange = up;
                });
            },

            dragStart(e, id) {
                const win = document.getElementById(id);
                let x = e.clientX - win.offsetLeft, y = e.clientY - win.offsetTop;
                const move = (ev) => { win.style.left = ev.clientX - x + 'px'; win.style.top = ev.clientY - y + 'px'; };
                document.addEventListener('mousemove', move);
                document.onmouseup = () => document.removeEventListener('mousemove', move);
            },

            maximize(id) {
                const w = document.getElementById(id);
                if(w.style.width === '100%') { w.style.width='900px'; w.style.height='600px'; }
                else { w.style.width='100%'; w.style.height='calc(100vh - 48px)'; w.style.top='0'; w.style.left='0'; }
            }
        };
    </script>
</body>
</html>
