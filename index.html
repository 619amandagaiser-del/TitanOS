<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ShadowV5.3 | Stealth</title>
    <script src="https://js.puter.com/v2/" defer></script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono&family=Inter:wght@400;900&display=swap" rel="stylesheet">
    
    <style>
        :root { --accent: #3b82f6; --win-bg: #0f172a; --text: #e2e8f0; }
        body { margin: 0; overflow: hidden; height: 100vh; font-family: 'Inter', sans-serif; background: #000; color: var(--text); }
        
        #desktop { height: calc(100vh - 48px); padding: 20px; display: flex; flex-direction: column; gap: 20px; background: radial-gradient(circle at center, #1e293b 0%, #000 100%); }
        
        .icon { width: 70px; text-align: center; cursor: pointer; transition: 0.2s; }
        .icon:hover { transform: scale(1.1); }
        .icon i { font-size: 40px; color: var(--accent); }
        .icon span { display: block; font-size: 11px; margin-top: 5px; font-weight: bold; }

        /* Window & Internal Browser */
        .window { position: absolute; background: var(--win-bg); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; display: flex; flex-direction: column; overflow: hidden; box-shadow: 0 20px 50px rgba(0,0,0,0.5); }
        .win-bar { height: 40px; background: #1e293b; display: flex; align-items: center; padding: 0 15px; cursor: move; }
        .win-title { font-size: 12px; font-weight: 900; flex-grow: 1; letter-spacing: 1px; }
        
        .browser-ui { display: flex; flex-direction: column; height: 100%; background: #fff; }
        .address-bar { display: flex; align-items: center; gap: 10px; padding: 10px; background: #0f172a; border-bottom: 1px solid #334155; }
        .url-box { flex-grow: 1; background: #1e293b; border: 1px solid #334155; color: #64748b; padding: 8px 15px; border-radius: 6px; font-family: 'JetBrains Mono'; font-size: 11px; outline: none; }
        .url-box:focus { color: #fff; border-color: var(--accent); }

        iframe { width: 100%; height: 100%; border: none; background: white; }

        #taskbar { position: absolute; bottom: 0; width: 100%; height: 48px; background: rgba(15, 23, 42, 0.9); backdrop-filter: blur(10px); border-top: 1px solid rgba(255,255,255,0.1); display: flex; align-items: center; padding: 0 20px; }
        .panic-btn { color: #ef4444; font-size: 10px; font-weight: bold; cursor: pointer; margin-left: auto; }
    </style>
</head>
<body onload="OS.init()">

    <div id="desktop">
        <div class="icon" onclick="OS.openBrowser()">
            <i class="material-icons-round">public</i>
            <span>BROWSER</span>
        </div>
    </div>

    <div id="taskbar">
        <div style="font-weight: 900; font-size: 14px;">SHADOW <span style="color:var(--accent)">OS</span></div>
        <div class="panic-btn" onclick="location.href='https://google.com'">ESC TO PANIC</div>
    </div>

    <script>
        const OS = {
            init() {
                document.addEventListener('keydown', e => { if(e.key === "Escape") location.href='https://google.com'; });
            },

            // Generator for the random obfuscated string
            generateGarbage(url) {
                const prefix = "system_idx_";
                const randomHash = btoa(url).substring(0, 16); // Base64 encode the URL
                const entropy = Math.random().toString(36).substring(7);
                return `${prefix}${randomHash}_${entropy}.tmp`;
            },

            openBrowser() {
                const id = 'win_' + Date.now();
                const win = document.createElement('div');
                win.className = 'window';
                win.id = id;
                win.style.width = '900px'; win.style.height = '600px';
                win.style.left = '50px'; win.style.top = '50px';

                win.innerHTML = `
                    <div class="win-bar" onmousedown="OS.dragStart(event, '${id}')">
                        <div class="win-title">SHADOW BROWSER</div>
                        <div onclick="document.getElementById('${id}').remove()" style="cursor:pointer; color:#ef4444;">âœ•</div>
                    </div>
                    <div class="browser-ui">
                        <div class="address-bar">
                            <i class="material-icons-round" style="font-size:18px; color:#475569;">lock</i>
                            <input type="text" class="url-box" id="url_${id}" 
                                placeholder="Search or enter URL..." 
                                onfocus="this.value=''" 
                                onkeypress="if(event.key==='Enter') OS.navigate('${id}')">
                        </div>
                        <iframe id="frame_${id}" src="about:blank"></iframe>
                    </div>
                `;
                document.body.appendChild(win);
            },

            async navigate(winId) {
                const input = document.getElementById(`url_${winId}`);
                const frame = document.getElementById(`frame_${winId}`);
                let rawUrl = input.value;

                // 1. Determine destination
                let targetUrl = rawUrl;
                if (!rawUrl.includes('.') || rawUrl.includes(' ')) {
                    targetUrl = `https://www.google.com/search?q=${encodeURIComponent(rawUrl)}&igu=1`;
                } else {
                    if (!targetUrl.startsWith('http')) targetUrl = 'https://' + targetUrl;
                }

                // 2. Obfuscate the URL box immediately
                const garbage = this.generateGarbage(targetUrl);
                input.value = garbage;
                input.blur(); // Remove focus so user doesn't see real URL

                // 3. Load into iframe (No new tabs)
                try {
                    // Using Puter's fetch to bypass some X-Frame-Options
                    const resp = await puter.net.fetch(targetUrl);
                    const blob = await resp.blob();
                    frame.src = URL.createObjectURL(blob);
                } catch (e) {
                    frame.src = targetUrl; // Fallback
                }
            },

            dragStart(e, id) {
                const win = document.getElementById(id);
                let x = e.clientX - win.offsetLeft;
                let y = e.clientY - win.offsetTop;
                const move = (ev) => { win.style.left = ev.clientX - x + 'px'; win.style.top = ev.clientY - y + 'px'; };
                document.addEventListener('mousemove', move);
                document.onmouseup = () => document.removeEventListener('mousemove', move);
            }
        };
    </script>
</body>
</html>
